/*! boilerplatenew v1.0.0 | Copyright 2018 Weronika KÄ™dziora */

/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 0);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance"); }

function _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }

function _nonIterableSpread() { throw new TypeError("Invalid attempt to spread non-iterable instance"); }

function _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === "[object Arguments]") return Array.from(iter); }

function _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }

// creating required number of slices for fill data (name and value)
var createDataForm = function createDataForm(nr) {
  var sectionDetails = document.querySelector('.section--itemsData');
  sectionDetails.style.display = "block";
  var currentNrOfSlices = document.querySelectorAll('.form__slice').length;
  var formContent = document.querySelector('.form__content');

  if (currentNrOfSlices > nr) {
    formContent.removeChild(formContent.lastChild);
    createDataForm(nr);
  } else {
    for (var i = currentNrOfSlices; i < nr; i++) {
      var divSlice = document.createElement('div');
      divSlice.classList.add('form__slice');
      var title = document.createElement('h3');
      title.classList.add('title');
      title.textContent = "Slice ".concat(i + 1);
      var divName = document.createElement('div');
      divName.classList.add('form__data');
      var labelDataName = document.createElement('label');
      labelDataName.setAttribute('for', "input".concat(i));
      labelDataName.innerHTML = "Name: ";
      labelDataName.classList.add('form__label');
      divName.appendChild(labelDataName);
      var inputDataName = document.createElement('input');
      inputDataName.setAttribute('type', 'text');
      inputDataName.setAttribute('id', "input".concat(i));
      inputDataName.classList.add('form__input', 'sliceName');
      divName.appendChild(inputDataName);
      var divVal = document.createElement('div');
      divVal.classList.add('form__Data', 'form__DataVal');
      var labelDataVal = document.createElement('label');
      labelDataVal.setAttribute('for', "inputVal".concat(i));
      labelDataVal.innerHTML = "Value: ";
      labelDataVal.classList.add('form__label');
      divVal.appendChild(labelDataVal);
      var inputDataVal = document.createElement('input');
      inputDataVal.setAttribute('type', 'text');
      inputDataVal.setAttribute('id', "inputVal".concat(i));
      inputDataVal.setAttribute('placeholder', 'Write only numbers');
      inputDataVal.classList.add('form__input', 'sliceValue');
      divVal.appendChild(inputDataVal);
      divSlice.appendChild(title);
      divSlice.appendChild(divName);
      divSlice.appendChild(divVal);
      formContent.appendChild(divSlice);
    }
  }

  if (currentNrOfSlices <= nr) {
    drawPieChart();
  }
}; // event for sumbit first form


var buttonMainData = document.querySelector('.button--mainData');
buttonMainData.addEventListener('click', function () {
  var chosenOption = document.querySelector('.select--numberOfItems');
  createDataForm(chosenOption.selectedIndex + 2);
}); // validation value inputs asynchronous (event delegation)

var formContent = document.querySelector('.form__content');
formContent.addEventListener('keyup', function (e) {
  if (e.target.parentElement.classList[1] === 'form__DataVal') {
    var text = e.target.value;
    var isValid = /^\d{1,}\.{0,1}\d{0,}$/.test(text);
    e.target.classList.remove('inputValue--valid');
    e.target.formNoValidate = false;

    if (isValid === false) {
      e.target.classList.add('inputValue--valid');
      e.target.formNoValidate = true;
    }
  }
}); // function to creating chart

var drawPieChart = function drawPieChart() {
  var chartContainer = document.querySelector('.article--chart');
  chartContainer.style.display = "flex"; // sending title

  var chartTitle = document.querySelector('#chartTitle').value;
  var titleContainer = document.querySelector('.title--chart');
  titleContainer.textContent = chartTitle; // getting data

  var dataNamesLabels = document.querySelectorAll('.sliceName');
  var dataNames = [];
  dataNamesLabels.forEach(function (label) {
    dataNames.push(label.value);
  });
  var dataValuesLabels = document.querySelectorAll('.sliceValue');
  var dataValues = [];
  dataValuesLabels.forEach(function (label) {
    dataValues.push(label.value);
  });
  var numberOfValues = dataValues.length;
  var leadingColor = document.querySelector('.input--color').value; // Colors functions generating table of colors for slices

  var getColorsTable = function getColorsTable() {
    var hexToDec = function hexToDec(val) {
      return parseInt(val, 16);
    };

    var decToHex = function decToHex(val) {
      return val !== 0 ? val.toString(16) : '00';
    };

    var leadingColorRGB = leadingColor.match(/../g).map(hexToDec);

    var getHexaColorsTable = function getHexaColorsTable(rgb) {
      var step = ~~((255 - Math.min.apply(Math, _toConsumableArray(rgb))) / numberOfValues);

      var getNewColor = function getNewColor(rgb, i) {
        return rgb.map(function (x) {
          return Math.min(x + step * i, 255);
        });
      };

      var getNewRGB = function getNewRGB(leadingColor, nrOfColors) {
        return Array(nrOfColors).fill(leadingColor).map(getNewColor);
      };

      var newRGB = getNewRGB(rgb, numberOfValues);
      return newRGB.map(function (rgb) {
        return ['#'].concat(_toConsumableArray(rgb.map(decToHex))).join('');
      });
    };

    return getHexaColorsTable(leadingColorRGB);
  };

  var colors = getColorsTable(); // creating data array

  var sum = dataValues.reduce(function (a, b) {
    return a * 1 + b * 1;
  }, 0);
  var percentage = dataValues.map(function (x) {
    return Math.round(x * 1000 / sum / 10);
  });

  var getData = function getData(i) {
    return {
      name: dataNames[i],
      value: dataValues[i],
      percent: percentage[i]
    };
  };

  var getBasicValuesForArr = function getBasicValuesForArr(x) {
    for (var i in dataNames) {
      x.push(getData(i));
    }
  };

  var addColorToArr = function addColorToArr(arr) {
    return arr.map(function (x, i) {
      return x.color = colors[i];
    });
  };

  var dataForDrawChart = [];
  getBasicValuesForArr(dataForDrawChart);
  dataForDrawChart.sort(function (a, b) {
    return a.value - b.value;
  }).reverse();
  addColorToArr(dataForDrawChart); // Creating SVG chart

  var radius = svg.style.width.slice(0, -2) / 2;

  var calculateDeg = function calculateDeg(percent) {
    return 360 * percent / 100;
  };

  var calculateBaseDeg = function calculateBaseDeg(deg) {
    return deg > 180 ? 360 - deg : deg;
  };

  var calculateRadian = function calculateRadian(baseDeg) {
    return baseDeg * Math.PI / 180;
  };

  var calculateRatios = function calculateRatios(percent) {
    var deg = calculateDeg(percent);
    var baseDeg = calculateBaseDeg(deg);
    var radians = calculateRadian(baseDeg);
    var sweep = radians > Math.PI ? '1' : '0';
    var valueZ = Math.sqrt(2 * Math.pow(radius, 2) * (1 - Math.cos(radians)));
    var baseValX = baseDeg <= 90 ? radius * Math.sin(radians) : radius * Math.sin((180 - baseDeg) * Math.PI / 180);
    var valueX = deg <= 180 ? baseValX + radius : radius - baseValX;
    var valueY = Math.sqrt(Math.pow(valueZ, 2) - Math.pow(baseValX, 2));
    return [deg, sweep, valueX, valueY];
  };

  var drawSegment = function drawSegment(data, i) {
    var _calculateRatios = calculateRatios(data.percent),
        _calculateRatios2 = _slicedToArray(_calculateRatios, 4),
        deg = _calculateRatios2[0],
        sweep = _calculateRatios2[1],
        valueX = _calculateRatios2[2],
        valueY = _calculateRatios2[3];

    var newPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    newPath.setAttributeNS(null, 'fill', data.color);
    newPath.setAttributeNS(null, 'd', "M".concat(radius, ",").concat(radius, " L").concat(radius, ",0 A").concat(radius, ",").concat(radius, " ").concat(sweep, " 1,1 ").concat(valueX, ", ").concat(valueY, " z"));
    newPath.textContent = "Name: ".concat(data.name, ", Value: ").concat(data.value, ", Percent: ").concat(data.percent, "%");
    newPath.setAttributeNS(null, 'transform', "rotate(".concat(rotation, ", ").concat(radius, ", ").concat(radius, ")"));
    rotation += deg;
    svg.appendChild(newPath);
  };

  var rotation = 0;

  for (var i = 0; i < numberOfValues; i++) {
    drawSegment(dataForDrawChart[i], i);
  }
}; // invoking drawing pie chart (check validate inputs)


var buttonCreateChart = document.querySelector('.button--createChart');
buttonCreateChart.addEventListener('click', function () {
  var areValueInputsValid = document.querySelector('.inputValue--valid') === null;

  if (areValueInputsValid) {
    console.log('areValueInputsValid - draw');
    drawPieChart();
  }
}); // Tooltip

var svg = document.querySelector('.svg');
var tooltip = document.querySelector('.tooltip');
svg.addEventListener('mousemove', function (e) {
  if (e.target.nodeName === 'path') {
    tooltip.style.left = "".concat(e.clientX + 20, "px");
    tooltip.style.top = "".concat(e.clientY - 30, "px");
    tooltip.style.display = 'block';
    tooltip.textContent = e.target.textContent;
  }
});
svg.addEventListener('mouseout', function (e) {
  if (e.target.nodeName === 'path') {
    tooltip.style.display = 'none';
  }
});

/***/ })
/******/ ]);